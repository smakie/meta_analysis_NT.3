---
title: "meta_analysis_NT"
output: html_document
date: '2022-03-05'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(metafor)
library(tidyverse)
library(kableExtra)
library(openxlsx)
```

## R Markdown

```{r things_I_dont_know}
#if(!"tinytex" %in% rownames(installed.packages())) install.packages("tinytex")
#tinytex::install_tinytex()
#if(!"devtools" %in% rownames(installed.packages())) install.packages("devtools")
#devtools::install_github("crsh/papaja")
```

```{r effect_size_conversion}
#Converts from Student's t to Pearson's r
t_to_r <- function(t, n, k){sqrt(
  (t^2)/((t^2)+(n-1-k))
  )}

t_to_r(t = 2.34, n = 251, k = 4)


######################################################################
#Cohen's f-squared to r (Cohen, 1988; checked)
f2_to_r <- function(f2){
  sqrt(
    (f2)/(1+f2)
  )
}


######################################################################
#r to Fisher's z
#Fisher's z of r can be calculated using one of the following functions
#Equation 1:
r_to_fz <- function(r){
  (log((1+r)/(1-r)))/2
  }
#Equation 2:
atanh(0.439941345)
#Proving that both functions are the same 
r_to_fz (0.439941345) - atanh(0.439941345)


######################################################################
#variance of Fisher's z (checked)
var_fz <- function(n){1/(n-3)}
sqrt(var_fz(50))


######################################################################
#Standard error of Fisher's z (checked)
se_fz <- function(n)(sqrt(1/(n-3)))


######################################################################
#Confidence Interval for Fisher's z 
ci_fz <- function(fz, se_fz, cl){
  lower <- fz-(((qnorm(p = ((1-((1-cl)/2))), mean = 0, sd = 1)))*(se_fz))
  upper <- fz+(((qnorm(p = ((1-((1-cl)/2))), mean = 0, sd = 1)))*(se_fz))
  return(c(lower, upper))}


######################################################################
#Hybrid function that returns Fisher's z, variance of Fisher's z, Standard Error of Fisher's z, and confidence intervals 
r_to_fz.2 <- function(r, n, cl){
  r <- r
  n <- n
  fz <- (log((1+r)/(1-r)))/2
  var_fz <- (1/(n-3))
  se_fz <- sqrt(1/(n-3))
  lower_ci <- fz-(((qnorm(p = ((1-(1-cl)/2)), mean = 0, sd = 1)))*(se_fz))
  upper_ci <- fz+(((qnorm(p = ((1-(1-cl)/2)), mean = 0, sd = 1)))*(se_fz))
  return(data.frame(r, n, fz, var_fz, se_fz, lower_ci, upper_ci))
}
#Example 
r_to_fz.2(r = 0.778, n = 78, cl = .95)


######################################################################
#A function that convert Pearson's r to Fisher's z 
#Returns the effect size, variance, standard error, and confidence intervals for both Pearson's r and Fisher's z
rzr <- function(data, cl){
  data %>% mutate(fz = (log((1+r)/(1-r)))/2) %>% 
    mutate(fz.2 = atanh(r)) %>% 
    mutate(var_fz = 1/(n-3)) %>% 
    mutate(se_fz = sqrt(1/(n-3))) %>% 
    mutate(weight = 1/var_fz) %>% 
    mutate(CI_lower_fz = fz-(((qnorm(p = ((1-((1-cl)/2))), mean = 0, sd = 1)))*(se_fz))) %>% 
    mutate(CI_upper_fz = fz+(((qnorm(p = ((1-((1-cl)/2))), mean = 0, sd = 1)))*(se_fz))) %>% 
    mutate(var_r = (exp(2*var_fz)-1)/(exp(2*var_fz)+1)) %>% 
    mutate(se_r = (exp(2*se_fz)-1)/(exp(2*se_fz)+1)) %>% 
    mutate(CI_lower_r = (exp(2*CI_lower_fz)-1)/(exp(2*CI_lower_fz)+1)) %>% 
    mutate(CI_upper_r = (exp(2*CI_upper_fz)-1)/(exp(2*CI_upper_fz)+1))
}
######################################################################
#Fisher's z to r
#Function 1
fz_to_r <- function(fz){
  (exp(2*fz)-1)/(exp(2*fz)+1)
}

#Proving that both functions are the same 
fz_to_r(0.56) - tanh(0.56)


######################################################################
#Partial correlation 
pr <- function(r_ac, r_bc, r_ab.c){
  r_ab <- (r_ab.c*(sqrt((1-(r_ac^2))*(1-(r_bc^2)))))+(r_ac*r_bc)
  return(c(r_ab))}
pr(r_ab.c = 0.343110576, r_ac = 0.493963561, r_bc = 0.42)

######################################################################
time_converter <- function(min, d, m, y){
      mins <- ifelse(
    missing(min),
    ifelse(
      missing(d),
      ifelse(
        missing(m),
        y*525960,
        m*44560.5),
      d*1440),
    min*1)
    days <- ifelse(
    missing(d),
    ifelse(
      missing(min),
      ifelse(
        missing(m),
        y*365.25,
        m*30.4375),
      min/1440),
    d*1)
  months <- ifelse(
    missing(m),
    ifelse(
      missing(min), 
      ifelse(
        missing(d), 
        y*12, 
        d/30.4375),
      min/43830),
    m*1)
  years <- ifelse(
    missing(y),
    ifelse(
      missing(min), 
      ifelse(
        missing(d), 
        m/12, 
        d/365.25),
      min/525960),
    y*1)
  return(tibble(mins,days, months, years))
}



time_converter(y = 4)
time_converter(m = 4)
time_converter(d = 32.99)
time_converter(min = 10)
1461 + 121.75	
1582.75 + 10.5
(1132.275 + 1165.265)/2
qnorm(p = .95, mean = 0, sd = 1)

698/1.644854
```


```{r data_construction}
#Variables
study = c("klibanoff_et_al.2006",
          "levine_et_al.2010",
          "boonen_et_al.2011",
          "gunderson_et_al.2013",
          "susperreguy.2014",
          "ramani_et_al.2015",
          "susperreguy_and_davis_kean.2016",
          "trawick_smith_et_al.2016",
          "elliott_et_al.2017",
          "mustaf_yildiz_et_al.2018",
          "glenn_et_al.2018",
          "von_spreckelsen_et_al.2019",
          "son_and_hur.2020", 
          "gibson_et_al.2020_a", 
          "gibson_et_al.2020_b"
          )
#gibson_et_al.2020_a - Small number
#gibson_et_al.2020_b - Large number  
data <- data.frame(study)
data_2 <- data %>% add_column(
  effect_size = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), 
  n = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  children_mean_age = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  nt_type = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  maths_ability_type = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, "Cardinality", "Cardinality"),
  deliverer = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  intervention_time = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  time_interval = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)) 
data_3 <- data_2 %>% mutate(
  effect_size = as.numeric(effect_size),
  children_mean_age = as.numeric(children_mean_age),
  n = as.integer(n),
  nt_type = as.factor(nt_type),
  maths_ability_type = as.factor(maths_ability_type),
  deliverer = as.factor(deliverer),
  intervention_time = as.numeric(intervention_time), 
  time_interval = as.numeric(time_interval)
  ) %>% as.data.frame()
data_3
data_3 
```



```{r son_and_hur.2020}
son_and_hur.2020_tib <- c(
  "son_and_hur.2020a", 
  "son_and_hur.2020b") %>% data.frame() %>% rename(., effect = .) %>% add_column(
    effect_description = c("Total Math Talk - Fall MA", "Total Maths Talk - Spring MA"),
    year = c(2020, 2020),
    country = c("US", "US"),
    sample_id = c("i", "i"),
    design = c("Correlational", "Correlational"),
    design.2 = c("Longitudinal_Correlational", "Longitudinal_Correlational"), 
    SES = c("Low", "Low"),
    main_language = c("English", "English"),
    deliverer_type = c("Parent", "Parent"),
    mothers = c(1, 1),
    white = c(0.500, 0.500), 
    female = c(0.47826087, 0.47826087),
    child_age_exp_start = c(1717.284, 1717.284),
    child_age_NT_start = c(NA, NA),
    child_age_NT_mid = c(1793.378, 1793.378),
    child_age_NT_end = c(NA, NA),
    child_age_MA = c(1793.378, 2067.315),
    NT_measure_time = c(17.5, 17.5),
    time_between_NT_mid_end = c(0, 273.937),
    intervention_dosage = c(NA, NA),
    NT_context = c("Home", "Home"),
    MA_context = c("School", "School"),
    NT_size = c(NA, NA),
    NT_type = c("Overall", "Overall"),
    MA_test = c("WJ_AP", "WJ_AP"),
    MA_measure = c("Overall", "Overall"),
    analysis = c("Zero Order Correlation", "Zero Order Correlation"),
    controlled_variables = c(0, 0),
    r = c(0.22, 0.21),
    n = c(29, 29)) 
son_and_hur.2020_tib 
```


```{r ramani_et_al.2015}
ramani_et_al.2015_tib <- c(
  "ramani_et_al.2015a", 
  "ramani_et_al.2015b", 
  "ramani_et_al.2015c", 
  "ramani_et_al.2015d",
  "ramani_et_al.2015e",
  "ramani_et_al.2015f",
  "ramani_et_al.2015g",
  "ramani_et_al.2015h",
  "ramani_et_al.2015i",
  "ramani_et_al.2015j",
  "ramani_et_al.2015k",
  "ramani_et_al.2015l") %>% data.frame() %>% rename(., effect = .) %>% add_column(
    effect_description = c("Counting and Number Identification - Verbal Counting", "Cardinality and Ordering  - Verbal Counting", "Counting and Number Identification - Number Identification", "Cardinality and Ordering - Number Identification", "Counting and Number Identification - Counting principles", "Cardinality and Ordering - Counting principles", "Counting and Number Identification - Enumeration and Cardinality", "Cardinality and Ordering - Enumeration and Cardinality", "Counting and Number Identification - Number Line Estimation", "Cardinality and Ordering - Number Line Estimation", "Counting and Number Identification - Magnitude Comparison", "Cardinality and Ordering - Magnitude Comparison"),
    year = c(2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015),
    country = c("US", "US", "US", "US", "US", "US", "US", "US", "US", "US", "US", "US"),
    sample_id = c("c", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c"),
    design = c("Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational"),
    design.2 = c("Longitudinal Correlational", "Longitudinal Correlational", "Longitudinal Correlational", "Longitudinal Correlational", "Longitudinal Correlational", "Longitudinal Correlational", "Longitudinal Correlational", "Longitudinal Correlational", "Longitudinal Correlational", "Longitudinal Correlational", "Longitudinal Correlational", "Longitudinal Correlational"), 
    SES = c("Low", "Low", "Low", "Low", "Low", "Low", "Low", "Low", "Low", "Low", "Low", "Low"),
    main_language = c("English", "English", "English", "English", "English", "English", "English", "English", "English", "English", "English", "English"),
    deliverer_type = c("Caregiver", "Caregiver", "Caregiver", "Caregiver", "Caregiver", "Caregiver", "Caregiver", "Caregiver", "Caregiver", "Caregiver", "Caregiver", "Caregiver"),
    mothers = c(0.787878788, 0.787878788, 0.787878788, 0.787878788, 0.787878788, 0.787878788, 0.787878788, 0.787878788, 0.787878788, 0.787878788, 0.787878788, 0.787878788),
    white = c(0.33, 0.33, 0.33, 0.33, 0.33, 0.33, 0.33, 0.33, 0.33, 0.33, 0.33, 0.33), 
    female = c(0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6),
    child_age_exp_start = c(1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75),
    child_age_NT_start = c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA),
    child_age_NT_mid = c(1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75, 1582.75),
    child_age_NT_end = c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA),
    child_age_MA = c(1593.25, 1593.25, 1593.25, 1593.25, 1593.25, 1593.25, 1593.25, 1593.25, 1593.25, 1593.25, 1593.25, 1593.25),
    NT_measure_time = c(15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15),
    time_between_NT_mid_end = c(10.5, 10.5, 10.5, 10.5, 10.5, 10.5, 10.5, 10.5, 10.5, 10.5, 10.5, 10.5),
    intervention_dosage = c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA),
    NT_context = c("Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom"),
    MA_context = c("Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom"),
    NT_size = c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA),
    NT_type = c("Counting and Number Identificaton", "Cardinality and Ordering", "Counting and Number Identificaton", "Cardinality and Ordering", "Counting and Number Identificaton", "Cardinality and Ordering", "Counting and Number Identificaton", "Cardinality and Ordering", "Counting and Number Identificaton", "Cardinality and Ordering", "Counting and Number Identificaton", "Cardinality and Ordering"),
    MA_test = c("Verbal Counting", "Verbal Counting", "Number Identification", "Number Identification", "Counting Principles", "Counting Principles", "Enumeration and Cardinality", "Enumeration and Cardinality", "Number Line Estimation", "Number Line Estimation", "Magnitude Comparison", "Magnitude Comparison"),
    MA_measure = c("Counting", "Counting", "Number Identificaiton", "Number Identification", "Counting", "Counting", "Cardinality", "Cardinality", "Number Sense", "Number Sense", "Magnitude Comparison", "Magnitude Comparison"),
    analysis = c("Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation"),
    controlled_variables = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
    r = c(-0.12, 0.11, -0.19, 0.10, 0.07, 0.17, -0.31, -0.03, 0.05, 0.37, 0.11, 0.39),
    n = c(33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33))
#ramani_et_al.2015_kable <- ramani_et_al.2015_tib %>% 
  #dplyr::mutate(dplyr::across(where(is.numeric), ~round(., 2))) %>% 
  #kable(format = "html", caption = "Ramani et al. (2015) effect sizes and associated inferential statistics", col.names = c("Effect id", "Effect Description", "Analysis", "Controlled variables","r", "n", "z", "Var of z", "SE of z", "Weight", "Lower CI for z", "Upper CI for z", "Var of r", "SE of r", "Lower CI for r", "Upper CI for r")) %>% kable_styling(full_width = T, position = "center") %>% row_spec(row = 0, extra_css = "border-bottom: 2px solid black;") #
ramani_et_al.2015_tib
```

```{r mutaf_yildiz et al.2018}
mutaf_yildiz_et_al.2018_tib <- c(
  "mutaf_yildiz_et_al.2018a", 
  "mutaf_yildiz_et_al.2018b"
  ) %>% data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("NT during book reading - Calculation skill", "NT during Lego playing - Calculation skill"),
      year = c(2018, 2018),
      country = c("BE", "BE"),
      sample_id = c("g", "g"),
      design = c("Correlational", "Correlational"),
      design.2 = c(" Cross_sectional_Correlational"), 
      SES = c("Middle", "Middle"),
      main_language = c("Dutch", "Dutch"),
      deliverer_type = c("Parent", "Parent"),
      mothers = c(0.682, 0.682),
      white = c(NA, NA), 
      female = c(0.454545455, 0.454545455),
      child_age_exp_start = c(2060.01, 2060.01),
      child_age_NT_start = c(NA, NA),
      child_age_NT_mid = c(2060.01, 2060.01),
      child_age_NT_end = c(NA, NA),
      child_age_MA = c(2060.01, 2060.01),
      NT_measure_time = c(5, 5),
      time_between_NT_mid_end = c(0, 0),
      intervention_dosage = c(NA, NA),
      NT_context = c("Home", "Home"),
      MA_context = c("Home", "Home"),
      NT_size = c(NA, NA),
      NT_type = c("Overall", "Overall"),
      MA_test = c("TediMath", "TediMath"),
      MA_measure = c("Calculation", "Calculation"),
      analysis = c("Zero Order Correlation", "Zero Order Correlation"),
      controlled_variables = c(0, 0),
      r = c(-0.05, -0.35),
      n = c(44, 44))
mutaf_yildiz_et_al.2018_tib
```

```{r elliott_et_al.2017}
elliott_et_al.2017_tib <- c(
  "elliott_et_al.2017a", 
  "elliott_et_al.2017b",
  "elliott_et_al.2017c", 
  "elliott_et_al.2017d") %>% 
  data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("Overall NT - TEMA-3", "Small NT (1-5) - TEMA-3", "Medium NT (6-10) - TEMA-3", "Large NT (11+) - TEMA-3"),
      year = c(2017, 2017, 2017, 2017),
      country = c("US", "US", "US", "US"),
      sample_id = c("e", "e", "e", "e"),
      design = c("Correlational", "Correlational", "Correlational", "Correlational"),
      design.2 = c("Cross_sectional_Correlational", "Cross_sectional_Correlational", "Cross_sectional_Correlational", "Cross_sectional_Correlational"), 
      SES = c("Middle", "Middle", "Middle", "Middle"),
      main_language = c("English", "English", "English", "English"),
      deliverer_type = c("Parent", "Parent", "Parent", "Parent"),
      mothers = c(1, 1, 1, 1),
      white = c(0.89, 0.89, 0.89, 0.89), 
      female = c(0.434782609, 0.434782609, 0.434782609, 0.434782609),
      child_age_exp_start = c(2116.928, 2116.928, 2116.928, 2116.928),
      child_age_NT_start = c(NA, NA, NA, NA),
      child_age_NT_mid = c(2116.928, 2116.928, 2116.928, 2116.928),
      child_age_NT_end = c(NA, NA, NA, NA),
      child_age_MA = c(2116.928, 2116.928, 2116.928, 2116.928),
      NT_measure_time = c(10, 10, 10, 10),
      time_between_NT_mid_end = c(0, 0, 0, 0),
      intervention_dosage = c(NA, NA, NA, NA),
      NT_context = c("Lab", "Lab", "Lab", "Lab"),
      MA_context = c("Lab", "Lab", "Lab", "Lab"),
      NT_size = c("Overall", "Small", "Medium", "Large"),
      NT_type = c("Overall", "Overall", "Overall", "Overall"),
      MA_test = c("TEMA_3", "TEMA_3", "TEMA_3", "TEMA_3"),
      MA_measure = c("Overall", "Overall", "Overall", "Overall"),
      analysis = c("Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation"),
      controlled_variables = c(0, 0, 0, 0),
      r = c(0.16, 0.13, -0.04, 0.39),
      n = c(44, 44, 44, 44))
elliott_et_al.2017_tib
```

```{r levine_et_al.2010}
levine_et_al.2010_tib <- c(
  "levine_et_al.2010a") %>% 
  data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("NT - Point-to-X"),
      year = c(2010),
      country = c("US"),
      sample_id = c("a"),
      design = c("Correlational"),
      design.2 = c("Longitudinal_Correlational"), 
      SES = c("Middle"),
      main_language = c("English"),
      deliverer_type = c("Caregiver"),
      mothers = c(NA),
      white = c(0.704545455), 
      female = c(0.454545455),
      child_age_exp_start = c(426.125),
      child_age_NT_start = c(426.125),
      child_age_NT_mid = c(669.625),
      child_age_NT_end = c(913.125),
      child_age_MA = c(1400.125),
      NT_measure_time = c(450),
      time_between_NT_mid_end = c(730.5),
      intervention_dosage = c(NA),
      NT_context = c("Home"),
      MA_context = c(NA),
      NT_size = c("Overall"),
      NT_type = c("Overall"),
      MA_test = c("Point-to-X"),
      MA_measure = c("Cardinality"),
      analysis = c("Zero Order Correlation"),
      controlled_variables = c(0),
      r = c(0.47),
      n = c(44))
levine_et_al.2010_tib
#CHECKS: 2
```

```{r gunderson_and_levine.2011}
#Uncontrolling SES 
#Effect e: NT with present objects, small set predicting Point-to-X (Uncontrolled for SES)
pr(r_ab.c = 0.343110576, r_ac = 0.493963561, r_bc = 0.42)
#Effect f: NT without present objects, small set predicting Point-to-X (Uncontrolled for SES)
pr(r_ab.c = 0.188982236, r_ac = 0.493963561, r_bc = 0.40)
#Effect g: NT with present objects, large set predicting Point-to-X (Uncontrolled for SES)
pr(r_ab.c = 0.455710387, r_ac = 0.493963561, r_bc = 0.23)
#Effect h: NT without present objects, large set predicting Point-to-X (Uncontrolled for SES)
pr(r_ab.c = 0.178174161, r_ac = 0.493963561, r_bc = 0.06)

(0.4782052 + 0.3481842)/2
(0.4992211 + 0.184278)/2

gunderson_and_levine.2011_tib <- c(
  "gunderson_and_levine.2011a", 
  "gunderson_and_levine.2011b") %>% 
  data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("Small NT predicting Point-to-X", "Large NT predicting Point-to-X"),
      year = c(2010, 2010),
      country = c("US", "US"),
      sample_id = c("a", "a"),
      design = c("Correlational", "Correlational"),
      design.2 = c("Longitudinal_Correlational", "Longitudinal_Correlational"), 
      SES = c("Middle", "Middle"),
      main_language = c("English", "English"),
      deliverer_type = c("Caregiver", "Caregiver"),
      mothers = c(NA, NA),
      white = c(0.704545455, 0.704545455), 
      female = c(0.454545455, 0.454545455),
      child_age_exp_start = c(426.125, 426.125),
      child_age_NT_start = c(426.125, 426.125),
      child_age_NT_mid = c(669.625, 669.625),
      child_age_NT_end = c(913.125, 913.125),
      child_age_MA = c(1400.125, 1400.125),
      NT_measure_time = c(450, 450),
      time_between_NT_mid_end = c(730.5, 730.5),
      intervention_dosage = c(NA, NA),
      NT_context = c("Home", "Home"),
      MA_context = c(NA, NA),
      NT_size = c("Small", "Large"),
      NT_type = c("Overall", "Overall"),
      MA_test = c("Point-to-X", "Point-to-X"),
      MA_measure = c("Cardinality", "Cardinality"),
      analysis = c("Calculated manually", "Calculated manually"),
      controlled_variables = c(0, 0),
      r = c(0.4131947, 0.3417495),
      n = c(44, 44)) 
gunderson_and_levine.2011_tib 
```

```{r boonen_et_al.2011}
boonen_et_al.2011_tib <- c(
  "boonen_et_al.2011a", 
  "boonen_et_al.2011b", 
  "boonen_et_al.2011c", 
  "boonen_et_al.2011d", 
  "boonen_et_al.2011e", 
  "boonen_et_al.2011f") %>% 
  data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("Calculation NT predicting General Number Sense", "Conventional Nominatives NT predicting General Number Sense", "Counting NT predicting ENT-R", "Ordering NT predicting ENT-R", "Number Symbols NT predicting ENT-R", "Cardinality NT predicting quantity comparison task"),
      year = c(2011, 2011, 2011, 2011, 2011, 2011),
      country = c("NE", "NE", "NE", "NE", "NE", "NE"),
      sample_id = c("b", "b", "b", "b", "b", "b"),
      design = c("Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational"),
      design.2 = c("Longitudinal_Correlational", "Longitudinal_Correlational", "Longitudinal_Correlational", "Longitudinal_Correlational", "Longitudinal_Correlational", "Longitudinal_Correlational"), 
      SES = c("Middle", "Middle", "Middle", "Middle", "Middle", "Middle"),
      main_language = c("Dutch", "Dutch", "Dutch", "Dutch", "Dutch", "Dutch"),
      deliverer_type = c("Teacher", "Teacher", "Teacher", "Teacher", "Teacher", "Teacher"),
      mothers = c(NA, NA, NA, NA, NA, NA),
      white = c(NA, NA, NA, NA, NA, NA), 
      female = c(0.501992032, 0.501992032, 0.501992032, 0.501992032, 0.501992032, 0.501992032),
      child_age_exp_start = c(1899.3, 1899.3, 1899.3, 1899.3, 1899.3, 1899.3),
      child_age_NT_start = c(NA, NA, NA, NA, NA, NA),
      child_age_NT_mid = c(NA, NA, NA, NA, NA, NA),
      child_age_NT_end = c(NA, NA, NA, NA, NA, NA),
      child_age_MA = c(NA, NA, NA, NA, NA, NA),
      NT_measure_time = c(60, 60, 60, 60, 60, 60),
      time_between_NT_mid_end = c(NA, NA, NA, NA, NA, NA),
      intervention_dosage = c(NA, NA, NA, NA, NA, NA),
      NT_context = c("Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom"),
      MA_context = c("Classroom", "Classroom", "Classroom", "Classroom", "Classroom", "Classroom"),
      NT_size = c(NA, NA, NA, NA, NA, NA),
      NT_type = c("Calculation", "Convetional Normatives", "Counting", "Ordering", "Number Symbols", "Cardinality"),
      MA_test = c("AD Number Sense", "AD Number Sense", "ENT-R", "ENT-R", "ENT-R", "Quantity Comparison Task"),
      MA_measure = c("Number Sense", "Number Sense", "Number Sense", "Number Sense", "Number Sense", "Number Sense"),
      analysis = c("Multiple Regression", "Multiple Regression", "Multiple Multilevel Regression", "Multiple Multilevel Regression", "Multiple Multilevel Regression", "Multiple Regression"),
      controlled_variables = c(5, 2, 7, 7, 7, 2),
      r = c(-0.1394642, 0.1733843, -0.1124199, -0.1356559, -0.1237494, 0.1187748),
      n = c(251, 251, 251, 251, 251, 251))
boonen_et_al.2011_tib
```


```{r susperreguy_and_davis_kean.2016}
susperreguy_and_davis_kean.2016_tib <- c(
  "susperreguy_and_davis_kean.2016a") %>% 
  data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("Proportion of Cumulative Math Talk - TEMA-3"),
      year = c(2016),
      country = c("US"),
      sample_id = c("d"),
      design = c("Correlational"),
      design.2 = c("Longitudinal_Correlational"), 
      SES = c("Middle"),
      main_language = c("English"),
      deliverer_type = c("Parent"),
      mothers = c(1),
      white = c(0.686), 
      female = c(0.314285714),
      child_age_exp_start = c(1643.625),
      child_age_NT_start = c(1643.625),
      child_age_NT_mid = c(1647.125),
      child_age_NT_end = c(1650.625),
      child_age_MA = c(2008.875),
      NT_measure_time = c(240),
      time_between_NT_mid_end = c(365.25),
      intervention_dosage = c(NA),
      NT_context = c("Home"),
      MA_context = c(NA),
      NT_size = c(NA),
      NT_type = c("Overall"),
      MA_test = c("TEMA_3"),
      MA_measure = c("Overall"),
      analysis = c("Zero Order Correlation"),
      controlled_variables = c(0),
      r = c(0.17),
      n = c(33)) 
susperreguy_and_davis_kean.2016_tib
```
      year = c(),
      country = c(),
      sample_id = c(),
      design = c(),
      design.2 = c(), 
      SES = c(),
      main_language = c(),
      deliverer_type = c(),
      mothers = c(),
      white = c(), 
      female = c(),
      child_age_exp_start = c(),
      child_age_NT_start = c(),
      child_age_NT_mid = c(),
      child_age_NT_end = c(),
      child_age_MA = c(),
      NT_measure_time = c(),
      time_between_NT_mid_end = c(),
      intervention_dosage = c(),
      NT_context = c(),
      MA_context = c(),
      NT_size = c(),
      NT_type = c(),
      MA_test = c(),
      MA_measure = c(),
```{r casey_et_al.2018}
casey_et_al.2018_tib <- c(
  "casey_et_al.2018a", 
  "casey_et_al.2018b",
  "casey_et_al.2018c", 
  "casey_et_al.2018d", 
  "casey_et_al.2018e", 
  "casey_et_al.2018f", 
  "casey_et_al.2018g", 
  "casey_et_al.2018h") %>% 
  data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("Identify numerals NT - WJ Applied Problems at 4.5 yrs", "Identify numerals NT - WJ Applied Problems at 1st grade", "One-to-one counting NT - WJ Applied Problems at 4.5 yrs", "One-to-one counting NT - WJ Applied Problems at 1st grade", "Label sets NT - WJ Applied Problems at 4.5 yrs", "Label sets NT - WJ Applied Problems at 1st grade", "Sum of numerical supports NT - WJ Applied Problems at 4.5 yrs", "Sum of numerical supports NT - WJ Applied Problems at 1st grade"),
      year = c(2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018),
      country = c("US", "US", "US", "US", "US", "US", "US", "US"),
      sample_id = c("f", "f", "f", "f", "f", "f", "f", "f"),
      design = c("Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational", "Correlational"),
      design.2 = c("Longitudinal_Correlational", "Longitudinal_Correlational", "Longitudinal_Correlational", "Longitudinal_Correlational", "Longitudinal_Correlational", "Longitudinal_Correlational", "Longitudinal_Correlational", "Longitudinal_Correlational"), 
      SES = c("Middle", "Middle", "Middle", "Middle", "Middle", "Middle", "Middle", "Middle"),
      main_language = c("English", "English", "English", "English", "English", "English", "English", "English"),
      deliverer_type = c("Parent", "Parent", "Parent", "Parent", "Parent", "Parent", "Parent", "Parent"),
      mothers = c(1, 1, 1, 1, 1, 1, 1, 1),
      white = c(0.84, 0.84, 0.84, 0.84, 0.84, 0.84, 0.84, 0.84), 
      female = c(0.45, 0.45, 0.45, 0.45, 0.45, 0.45, 0.45, 0.45),
      child_age_exp_start = c(NA, NA, NA, NA, NA, NA, NA, NA),
      child_age_NT_start = c(NA, NA, NA, NA, NA, NA, NA, NA),
      child_age_NT_mid = c(1095.75, 1095.75, 1095.75, 1095.75, 1095.75, 1095.75, 1095.75, 1095.75),
      child_age_NT_end = c(NA, NA, NA, NA, NA, NA, NA, NA),
      child_age_MA = c(1643.625, 2374.125, 1643.625, 2374.125, 1643.625, 2374.125, 1643.625, 2374.125),
      NT_measure_time = c(10, 10, 10, 10, 10, 10, 10, 10),
      time_between_NT_mid_end = c(547.875, 1278.375, 547.875, 1278.375, 547.875, 1278.375, 547.875, 1278.375),
      intervention_dosage = c(NA, NA, NA, NA, NA, NA, NA, NA),
      NT_context = c("Lab", "Lab", "Lab", "Lab", "Lab", "Lab", "Lab", "Lab"),
      MA_context = c(NA, NA, NA, NA, NA, NA, NA, NA),
      NT_size = c(NA, NA, NA, NA, NA, NA, NA, NA),
      NT_type = c("Number Identification", "Number Identification", "Counting", "Counting", "Labelling", "Labelling", "Overall", "Overall"),
      MA_test = c("WJ-AP", "WJ-AP", "WJ-AP", "WJ-AP", "WJ-AP", "WJ-AP", "WJ-AP", "WJ-AP"),
      MA_measure = c("Mathematical Problem Solving", "Mathematical Problem Solving", "Mathematical Problem Solving", "Mathematical Problem Solving", "Mathematical Problem Solving", "Mathematical Problem Solving", "Mathematical Problem Solving", "Mathematical Problem Solving"),
      analysis = c("Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation","Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation", "Zero Order Correlation"),
      controlled_variables = c(0, 0, 0, 0, 0, 0, 0, 0),
      r = c(-0.02, -0.04, -0.01, 0.05, 0.30, 0.33, 0.06, 0.07),
      n = c(99, 99, 99, 99, 99, 99, 99, 99))
casey_et_al.2018_tib
```

```{r zippert_et_al.2019}
zippert_et_al.2019_tib <- c(
  "zippert_et_al.2019a", 
  "zippert_et_al.2019b", 
  "zippert_et_al.2019c", 
  "zippert_et_al.2019d",
  "zippert_et_al.2019e",
  "zippert_et_al.2019f",
  "zippert_et_al.2019g",
  "zippert_et_al.2019h") %>% 
  data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("Counting NT - Rote Counting", "Number Identification NT - Rote Counting", "Cardinality NT - Rote Counting", "Magnitude Comparison NT - Rote Counting", "Counting NT - Number Line Estimation", "Number Identification NT - Number Line Estimation", "Cardinality NT - Number Line Estimation", "Magnitude Comparison NT - Number Line Estimation"),
      year = c(2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019),
      country = c("US", "US", "US", "US", "US", "US", "US", "US"),
      sample_id = c("h", "h", "h", "h", "h", "h", "h", "h"),
      design = c("Experimental", "Experimental", "Experimental", "Experimental", "Experimental", "Experimental", "Experimental", "Experimental"),
      design.2 = c("Short_term_Experimental", "Short_term_Experimental", "Short_term_Experimental", "Short_term_Experimental", "Short_term_Experimental", "Short_term_Experimental", "Short_term_Experimental", "Short_term_Experimental"), 
      SES = c(NA, NA, NA, NA, NA, NA, NA, NA),
      main_language = c("English", "English", "English", "English", "English", "English", "English", "English"),
      deliverer_type = c("Parent", "Parent", "Parent", "Parent", "Parent", "Parent", "Parent", "Parent"),
      mothers = c(0.61, 0.61, 0.61, 0.61, 0.61, 0.61, 0.61, 0.61),
      white = c(NA, NA, NA, NA, NA, NA, NA, NA), 
      female = c(0.41, 0.41, 0.41, 0.41, 0.41, 0.41, 0.41, 0.41),
      child_age_exp_start = c(1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99),
      child_age_NT_start = c(1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99),
      child_age_NT_mid = c(1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99),
      child_age_NT_end = c(1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99),
      child_age_MA = c(1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99, 1835.99),
      NT_measure_time = c(NA, NA, NA, NA, NA, NA, NA, NA),
      time_between_NT_mid_end = c(0, 0, 0, 0, 0, 0, 0, 0),
      intervention_dosage = c(0.006944444, 0.006944444, 0.006944444, 0.006944444, 0.006944444, 0.006944444, 0.006944444, 0.006944444),
      NT_context = c("Museum", "Museum", "Museum", "Museum", "Museum", "Museum", "Museum", "Museum"),
      MA_context = c("Museum", "Museum", "Museum", "Museum", "Museum", "Museum", "Museum", "Museum"),
      NT_size = c(NA, NA, NA, NA, NA, NA, NA, NA),
      NT_type = c("Counting", "Number Identification", "Cardinality", "Magnitude Comparison", "Counting", "Number Identification", "Cardinality", "Magnitude Comparison"),
      MA_test = c("Verbal Counting", "Verbal Counting", "Verbal Counting", "Verbal Counting", "Number Line Estimation", "Number Line Estimation", "Number Line Estimation", "Number Line Estimation"),
      MA_measure = c("Counting", "Counting", "Counting", "Counting", "Number Sense", "Number Sense", "Number Sense", "Number Sense"),
      analysis = c("Partial Correlation", "Partial Correlation", "Partial Correlation", "Partial Correlation", "Partial Correlation", "Partial Correlation", "Partial Correlation", "Partial Correlation"),
      controlled_variables = c(2, 2, 2, 2, 2, 2, 2, 2),
      r = c(-0.40, -0.03, 0.095, -0.065, 0.085, -0.01, -0.135, -0.01),
      n = c(51, 51, 51, 51, 51, 51, 51, 51))
zippert_et_al.2019_tib


```

```{r thippana_et_al.2020}
thippana_et_al.2020_tib <- c(
  "thippana_et_al.2020a", 
  "thippana_et_al.2020b") %>% 
  data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("Home NT proportion - TEMA-3 ", "Lab NT proportion - TEMA-3"),
      year = c(2020, 2020),
      country = c(NA, NA),
      sample_id = c("j", "j"),
      design = c("Correlational", "Correlational"),
      design.2 = c("Longitudinal_Correlational", "Longitudinal_Correlational"), 
      SES = c("Middle",  "Middle"),
      main_language = c("English", "English"),
      deliverer_type = c("Parent", "Parent"),
      mothers = c(0.94, 0.94),
      white = c(0.85, 0.85), 
      female = c(0.484536082, 0.484536082),
      child_age_exp_start = c(1430.562, 1430.562),
      child_age_NT_start = c(NA, NA),
      child_age_NT_mid = c(1446.172, 1446.172),
      child_age_NT_end = c(NA, NA),
      child_age_MA = c(1492.442, 1492.442),
      NT_measure_time = c(30, 20),
      time_between_NT_mid_end = c(46.27, 46.27),
      intervention_dosage = c(NA, NA),
      NT_context = c("Home", "Lab"),
      MA_context = c("Lab", "Lab"),
      NT_size = c(NA, NA),
      NT_type = c("Overall", "Overall"),
      MA_test = c("TEMA_3", "TEMA_3"),
      MA_measure = c("Overall", "Overall"),
      analysis = c("Zero Order Correlation", "Zero Order Correlation"),
      controlled_variables = c(0, 0),
      r = c(0.20, 0.11),
      n = c(81, 81))
thippana_et_al.2020_tib
```

```{r gibson_et_al.2020}
gibson_et_al.2020_tib <- c(
  "gibson_et_al.2020a", 
  "gibson_et_al.2020b") %>% 
  data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("Small Number Book vs Control", "Large Number vs Control"),
      year = c(2020, 2020),
      country = c("US", "US"),
      sample_id = c("k", "k"),
      design = c("Experimental", "Experimental"),
      design.2 = c("Long_term_Experimental", "Long_term_Experimental"), 
      SES = c("Middle", "Middle"),
      main_language = c("English", "English"),
      deliverer_type = c("Parent", "Parent"),
      mothers = c(NA, NA),
      white = c(0.52, 0.52), 
      female = c(0.52, 0.52),
      child_age_exp_start = c(1132.275, 1132.275),
      child_age_NT_start = c(1132.275, 1132.275),
      child_age_NT_mid = c(1148.77, 1148.77),
      child_age_NT_end = c(1165.265, 1165.265),
      child_age_MA = c(1165.265, 1165.265),
      NT_measure_time = c(NA, NA),
      time_between_NT_mid_end = c(16.495, 16.495),
      intervention_dosage = c(32.99, 32.99),
      NT_context = c("Home", "Home"),
      MA_context = c("Lab", "Lab"),
      NT_size = c("Small", "Large"),
      NT_type = c("Counting and Labelling", "Counting and Labelling"),
      MA_test = c("Give-N", "Give-N"),
      MA_measure = c("Number Knowledge", "Number Knowledge"),
      analysis = c("Pairwise t", "Pairwise t"),
      controlled_variables = c(0, 0),
      r = c(0.3224328, 0.069597355),
      n = c(97, 97)) 
gibson_et_al.2020_tib
```

```{r silver_et_al.2021}
silver_et_al.2021_tib <- c(
  "silver_et_al.2021a", 
  "silver_et_al.2021b",
  "silver_et_al.2021c") %>% 
  data.frame() %>% rename(., effect = .) %>% 
    add_column(
      effect_description = c("NT - MA","NT predicting MA for children with high inhibitory control", "NT predicting MA for children with low inhibitory control"),
      year = c(2021, 2021, 2021),
      country = c("US", "US", "US"),
      sample_id = c("l", "l", "l"),
      design = c("Correlational", "Correlational", "Correlational"),
      design.2 = c("Cross-sectional Correlational", "Cross-sectional Correlational", "Cross-sectional Correlational"), 
      SES = c("Middle", "Middle", "Middle"),
      main_language = c("English", "English", "English"),
      deliverer_type = c("Parent", "Parent", "Parent"),
      mothers = c(0.95, 0.95, 0.95),
      white = c(0.8, 0.8, 0.8), 
      female = c(0.479674797, 0.479674797, 0.479674797),
      child_age_exp_start = c(1430.562, 1430.562, 1430.562),
      child_age_NT_start = c(1430.562, 1430.562, 1430.562),
      child_age_NT_mid = c(1430.562, 1430.562, 1430.562),
      child_age_NT_end = c(1430.562, 1430.562, 1430.562),
      child_age_MA = c(1430.562, 1430.562, 1430.562),
      NT_measure_time = c(10, 10, 10),
      time_between_NT_mid_end = c(0, 0, 0),
      intervention_dosage = c(NA, NA, NA),
      NT_context = c("Lab", "Lab" , "Lab"),
      MA_context = c("Lab", "Lab", "Lab"),
      NT_size = c("Overall", "Overall", "Overall"),
      NT_type = c("Overall", "Overall", "Overall"),
      MA_test = c("TEMA_3", "TEMA_3", "TEMA_3"),
      MA_measure = c("Overall", "Overall", "Overall"),
      analysis = c("Zero Order Correlation", "Simple Slopes", "Simple Slopes"),
      controlled_variables = c(0, 1, 1),
      r = c(0.04, 0.1689442, -0.1129433),
      n = c(123, 123, 123))
silver_et_al.2021_tib


#lower_ci <- fz-(((qnorm(p = ((1-(1-cl)/2)), mean = 0, sd = 1)))*(se_fz))
#qnorm(p = ((1-(1-cl)/2)))
#1-((1-0.95)/2)
#1-pt(q = 1.886838378, df = 113)
#qt(p = 0.975, df = 113)
#qnorm(p = 0.975)
#-(-0.01 - 0.10)/qt(p = 0.975, df = 121)
#(0.20 - 0.10)/qt(p = 0.975, df = 121)
#((0.20 - 0.10)/qt(p = 0.975, df = 121) + (-(-0.01 - 0.10)/qt(p = 0.975, df = 121)))/2
#-(-0.16 - (-0.06))/qt(p = 0.975, df = 121)
#(0.03 -(-0.06))/qt(p = 0.975, df = 121)
#((-(-0.16 - (-0.06))/qt(p = 0.975, df = 121))+((0.03 -(-0.06))/qt(p = 0.975, df = 121)))/2
#qt(p = (1-0.038), df = 121)
#0.10/qt(p = (1-0.038), df = 121)
#qt(p = (1-0.0815), df = 121)
#-(-0.06/qt(p = (1-0.0815), df = 121))
#0.1 - (1.979764 * 0.05051108)
#sqrt((1.2503772 ^2)/((1.2503772^2)+121))

```

```{r meta}
meta_tib <- rbind(
  levine_et_al.2010_tib, 
  gunderson_and_levine.2011_tib, 
  boonen_et_al.2011_tib,
  ramani_et_al.2015_tib,
  susperreguy_and_davis_kean.2016_tib,
  elliott_et_al.2017_tib, 
  casey_et_al.2018_tib,
  mutaf_yildiz_et_al.2018_tib, 
  zippert_et_al.2019_tib,
  son_and_hur.2020_tib,
  thippana_et_al.2020_tib, 
  gibson_et_al.2020_tib, 
  silver_et_al.2021_tib) 
meta_tib %>% view()

#write.xlsx(meta_tib, "meta_tib.xlsx", overwrite = F)
meta_tib.escalc <- escalc(measure = "ZCOR", ri = r, ni = n, data = meta_tib) %>% data.frame()
#rma(yi = ri, vi = vi, data = meta_tib, method  = "DL", data = meta_data)

#Meta-analysis
meta_model <- rma(yi = yi, vi = vi, data = meta_tib.escalc, method  = "DL")
meta_model
#DL - 0.1407, 0.1314
#HE - 0.1406, 0.1278
#HSk - 0.1407, 0.1309
#HS - 0.1406, 0.1283
#ML - 0.1406, 0.1302
#REML - 0.1407, 0.1331
#SJ - 0.1414, 0.1614
#EB - 0.1407, 0.1319
#PM - 0.1407, 0.1319
#In the Forest 
forest(meta_model, addpred = T, header = T)

#It's a pyramid
funnel(meta_model)

#Predicting the future
predict(meta_model, transf = transf.ztor, digits = 5)

#Gosh Plot 
plot(gosh(meta_model, subset = 2000), out = 10)

meta_tib.escalc
```

```{r meta_regression}
#Meta-regression
rma(yi = yi, vi = vi, mod = ~ NT_measure_time,data = meta_tib.escalc, method  = "DL")
#Bubble plot 
#regplot(meta_model, xlab = "x label", xlim = c(-, -), predlim= c(), transf = )
#Significant result 
#Mother
#child_age_NT_mid

```


